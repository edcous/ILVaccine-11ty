<!doctype html>
<html>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/json2html/1.4.0/json2html.min.js"></script>
<script src="https://momentjs.com/downloads/moment.js"></script>
<script src="https://momentjs.com/downloads/moment-timezone-with-data.js"></script>
<script async defer data-domain="ilvaccine.com" src="https://analytics.ilvaccine.com/js/plausible.js"></script>
<meta property="og:site_name" content="ILVaccine">
<meta name="description" content="ILVaccine.org is a site that displays COVID-19 Coronavirus vaccine availablity for Cook, Lake, DuPage, Kane, Will and McHenry county in the state of Illinois.">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
<script>

    let yes_template ={"<>":"div","class":"card ml-4 mr-4 mb-2", "style":"min-width:70%","html":[
            {"<>":"div","class":"card-body","html":[
                {"<>":"h5","class":"card-title mb-2","html":"${Name}"}, 
                {"<>":"h6","class":"card-subtitle mb-4","html":function(){ return "Last checked " + moment(this["TimeChecked"]).tz("Atlantic/Madeira").fromNow()}}, 
                {"<>":"h6","class":"card-subtitle mb-4","style":"color: green", "html":"<i class='bi bi-check-circle-fill'></i> Appointments available"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"Address: ${Location}"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"County: ${County}"},
                {"<>":"p","class":"h6 card-subtitle mb-4 text-muted","html":"Eligibility: ${Eligibility}"},
                {"<>":"p","class":"card-text","html":"${Notes}"},
                {"<>":"a","href":"${Website}","class":"card-link","html":"Website"}
              ]}
          ]}
    let contact_template ={"<>":"div","class":"card ml-4 mr-4 mb-2", "style":"min-width:70%","html":[
            {"<>":"div","class":"card-body","html":[
                {"<>":"h5","class":"card-title mb-2","html":"${Name}"}, 
                {"<>":"h6","class":"card-subtitle mb-4","html":function(){ return "Last checked " + moment(this["TimeChecked"]).tz("Atlantic/Madeira").fromNow()}}, 
                {"<>":"h6","class":"card-subtitle mb-4","style":"color: Peru", "html":"<i class='bi bi-check-circle-fill'></i> Appointments available for patients"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"Address: ${Location}"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"County: ${County}"},
                {"<>":"p","class":"h6 card-subtitle mb-4 text-muted","html":"Eligibility: ${Eligibility}"},
                {"<>":"p","class":"card-text","html":"${Notes}"},
                {"<>":"a","href":"${Website}","class":"card-link","html":"Website"}
              ]}
          ]}

    let invite_template ={"<>":"div","class":"card ml-4 mr-4 mb-2", "style":"min-width:70%","html":[
            {"<>":"div","class":"card-body","html":[
                {"<>":"h5","class":"card-title mb-2","html":"${Name}"}, 
                {"<>":"h6","class":"card-text mb-4","html":function(){ return "Last checked " + moment(this["TimeChecked"]).tz("Atlantic/Madeira").fromNow()}}, 
                {"<>":"h6","class":"card-subtitle mb-4","style":"color: orange", "html":"<i class='bi bi-check-circle-fill'></i> Appointments available by invite only"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"Address: ${Location}"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"County: ${County}"},
                {"<>":"p","class":"h6 card-subtitle mb-4 text-muted","html":"Eligibility: ${Eligibility}"},
                {"<>":"p","class":"card-text","html":"${Notes}"},
                {"<>":"a","href":"${Website}","class":"card-link","html":"Website"}
              ]}
          ]}
    let no_template ={"<>":"div","class":"card ml-4 mr-4 mb-2", "style":"min-width:80%","html":[
            {"<>":"div","class":"card-body","html":[
                {"<>":"h5","class":"card-title mb-2","html":"${Name}"},
                {"<>":"h6","class":"card-text mb-4","html":function(){ return "Last checked " + moment(this["TimeChecked"]).tz("Atlantic/Madeira").fromNow()}}, 
                {"<>":"h6","class":"card-subtitle mb-4","style":"color: red", "html":"<i class='bi bi-x-circle-fill'></i> Appointments unavailable"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"${Location}"},
                {"<>":"h6","class":"card-subtitle mb-4 text-muted","html":"County: ${County}"},
                {"<>":"p","class":"h6 card-subtitle mb-4 text-muted","html":"Eligibility: ${Eligibility}"},
                {"<>":"p","class":"card-text","html":"${Notes}"},
                {"<>":"a","href":"${Website}","class":"card-link","html":"Website"}
              ]}
          ]}
    function wait(ms){
    var start = new Date().getTime();
    var end = start;
    while(end < start + ms) {
        end = new Date().getTime();
    }
    }
    const url='https://ilvaccine-api.us-east-1.linodeobjects.com/all.json' + '?v=' + Date.now();
    const http = new XMLHttpRequest()
    updateAppointmentStatus()
    function updateAppointmentStatus(){
        http.open("GET", url)
        http.send()
        http.onload = () => {
            var data = http.responseText
            console.log(data);
            var yesOnly = JSON.parse(data).filter(function (entry) {
                return entry["Appointments"] === 'Yes';
            });

            var inviteOnly = JSON.parse(data).filter(function (entry) {
                return entry["Appointments"] === 'Yes, by invite only';
            });
            var contactOnly = JSON.parse(data).filter(function (entry) {
                return entry["Appointments"] === 'Yes, for patients only';
            });
            var noOnly = JSON.parse(data).filter(function (entry) {
                return entry["Appointments"] === 'No';
            });

            wait(1)
            if(document.getElementById('apt-avail').checked){
                if(document.getElementById('county-select').value == "all"){
                    document.getElementById('yes-apt-cards').innerHTML = json2html.transform(yesOnly,yes_template);
                    document.getElementById('contact-apt-cards').innerHTML = ""
                    document.getElementById('invite-apt-cards').innerHTML = "";
                    document.getElementById('no-apt-cards').innerHTML = "";
                }
                else{
                    var yesOnlyCounty = JSON.parse(data).filter(function (entry) {
                        return (String(entry["County"]).includes(document.getElementById('county-select').value)) && (entry["Appointments"] === 'Yes');
                    });
                    document.getElementById('yes-apt-cards').innerHTML = json2html.transform(yesOnlyCounty,yes_template);
                    document.getElementById('contact-apt-cards').innerHTML = ""
                    document.getElementById('invite-apt-cards').innerHTML = ""
                    document.getElementById('no-apt-cards').innerHTML = "";
                }
            }
            else{
                if(document.getElementById('county-select').value == "all"){
                    document.getElementById('yes-apt-cards').innerHTML = json2html.transform(yesOnly,yes_template);
                    document.getElementById('contact-apt-cards').innerHTML = json2html.transform(contactOnly,contact_template);
                    document.getElementById('invite-apt-cards').innerHTML = json2html.transform(inviteOnly,invite_template);
                    document.getElementById('no-apt-cards').innerHTML = json2html.transform(noOnly,no_template);
                }
                else{
                    var yesOnlyCounty = JSON.parse(data).filter(function (entry) {
                        return (String(entry["County"]).includes(document.getElementById('county-select').value)) && (entry["Appointments"] === 'Yes');
                    });
                    var inviteOnlyCounty = JSON.parse(data).filter(function (entry) {
                        return (String(entry["County"]).includes(document.getElementById('county-select').value)) && (entry["Appointments"] === 'Yes, by invite only');
                    });
                    var noOnlyCounty = JSON.parse(data).filter(function (entry) {
                        return (String(entry["County"]).includes(document.getElementById('county-select').value)) && (entry["Appointments"] === 'No');
                    });
                    var contactOnlyCounty = JSON.parse(data).filter(function (entry) {
                        return (String(entry["County"]).includes(document.getElementById('county-select').value)) && (entry["Appointments"] === 'Yes, for patients only');
                    });
                    document.getElementById('yes-apt-cards').innerHTML = json2html.transform(yesOnlyCounty,yes_template);
                    document.getElementById('contact-apt-cards').innerHTML = json2html.transform(contactOnlyCounty,contact_template);
                    document.getElementById('invite-apt-cards').innerHTML = json2html.transform(inviteOnlyCounty,invite_template);
                    document.getElementById('no-apt-cards').innerHTML = json2html.transform(noOnlyCounty,no_template);
                }
            }

        }
    }

    //We do that to ensure to get a correct JSON
    //We can use {'name': 'Lenovo Thinkpad 41A429ff8'} as criteria too
</script>
<script>
var intervalId = window.setInterval(function(){
  updateAppointmentStatus()
}, 60000);
</script>
</head>
<body>
    <div class='header'>    
<div class="alert alert-primary alert-dismissible fade show" role="alert">
      Current Alerts:
      <br>
      - Unfortunately due to changes to Jewel's website, we are unable to auto-update Jewel-Osco at this time. We are working to solve this problem as soon as possible and will be manually updating in the meantime.
      <br>
      - Some areas are struggling to get their residents vaccinated, so please be conscious of booking in neighborhoods you don't usually visit.
   <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
</div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
        <a class="navbar-brand" href="/">ILVaccine</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarNav"><ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="/map">Map</a></li>
        <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown2" role="button" data-toggle="dropdown" data-target="#Dropdown2" aria-haspopup="true" aria-expanded="false">
            Contact
          </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown2" id="Dropdown2">
          <a class="dropdown-item" href="/forms/volunteer">Volunteer</a>
          <a class="dropdown-item" href="/forms/corrections">Corrections/Additions</a>
          <a class="dropdown-item" href="/forms/contact">Other Inquiries</a>
        </div>
        </li>
        </ul>
      </nav>
    </div>
      <h1 class="mb-5 text-center">Find a COVID Vaccine for you or a loved one</h1>
<div class="input-group mb-4" style="margin: auto; width:80%;">
    <div class="custom-control custom-switch mr-5">
        <input type="checkbox" class="custom-control-input" id="apt-avail" onclick="updateAppointmentStatus()">
        <label class="custom-control-label" for="apt-avail">Available appointments only</label>
    </div>
    <select name="counties" id="county-select" onchange='updateAppointmentStatus()' class="custom-select custom-select-sm" style="display: block;margin: 0 auto;">
        <option value="all" selected>All Counties</option>
        <option value="Cook">Cook</option>
        <option value="DuPage">DuPage - More Coming Soon</option>
        <option value="Kane">Kane</option>
        <option value="Lake">Lake</option>
        <option value="McHenry">McHenry - More Coming Soon</option>
        <option value="Will" disabled>Will - Coming Soon</option>
    </select>
    
    <button class='btn btn-primary text-end ml-5' onclick='updateAppointmentStatus()'>Refresh</button>
</div>
<p class='text-center'>Data auto refreshes every minute.</p>
<div id='yes-apt-cards'>
<div class="spinner-border align-items-center" role="status">
  <span class="sr-only">Loading...</span>
</div>
</div>
<div id='contact-apt-cards'>
</div>
<div id='invite-apt-cards'>
</div>
<div id='no-apt-cards'>
</div>
</body></body>
</html>